---
import BaseLayout from "../layouts/BaseLayout.astro";
import Hero from "../components/Hero.astro";
import SearchableResources from "../components/SearchableResources";
import { getPublishedItems } from "../lib/directus";
import type { Writing, DirectusResource } from "../lib/directus";

// Fetch writings and resources from Directus
const writings = await getPublishedItems<Writing>("writings");
const directusResources = await getPublishedItems<DirectusResource>("resources");

// Transform for SearchableResources component (matches resources.astro pattern)
const resources = directusResources.map(resource => ({
  id: String(resource.id),
  title: resource.title,
  category: resource.category,
  tags: resource.tags || [],
  description: resource.description,
  link: resource.resource_url || '',
  author: resource.author,
}));

// Extract categories and tags for filters
const categories = Array.from(new Set(resources.map(r => r.category))).sort();
const allTags = Array.from(new Set(resources.flatMap(r => r.tags))).sort();
---

<BaseLayout
  title="Study & Deepening"
  description="Explore study materials, sacred writings, and resources for spiritual deepening."
>
  <Hero
    title="Study & Deepening"
    subtitle="Explore the sacred writings and deepen your spiritual understanding"
    imageUrl="/images/bahai/buildings/mansion-bahji/mansion-bahji-001.jpg"
    overlayOpacity={55}
  />

  <section class="py-12">
    <div class="container mx-auto px-4">
      <div class="max-w-6xl mx-auto">
        <div class="bg-base-200 rounded-lg shadow-md p-8 mb-8">
          <h2 class="text-3xl font-bold text-base-content mb-6">
            The Ruhi Institute
          </h2>
          <p class="text-base-content mb-4 leading-relaxed">
            The Ruhi Institute is an educational institution that develops
            materials for the spiritual education of Baháʼís and others
            interested in serving humanity. Its courses help participants deepen
            their understanding of the Faith and develop the capacity to serve
            their communities.
          </p>
          <p class="text-base-content leading-relaxed">
            Study circles using Ruhi Institute materials are offered regularly
            in our community. These small group sessions provide a supportive
            environment for learning and personal growth.
          </p>
        </div>

        <div class="bg-primary/5 rounded-lg p-8 border border-primary/20">
          <h2 class="text-2xl font-bold text-base-content mb-4">
            Join a Study Circle
          </h2>
          <p class="text-base-content mb-6">
            Study circles meet regularly in homes and community centers. All are
            welcome to participate, regardless of background or belief.
          </p>
          <div class="flex gap-4">
            <a
              href="/events"
              class="bg-primary hover:bg-accent-cyan-dark text-white px-6 py-3 rounded-lg font-medium transition"
            >
              Find a Study Circle
            </a>
            <a
              href="/contact"
              class="bg-base-200 hover:bg-base-300 text-accent-cyan border-2 border-primary px-6 py-3 rounded-lg font-medium transition"
            >
              Contact Us
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Study Materials & Resources Section -->
  <section class="py-12 bg-base-100 border-t border-base-300">
    <div class="container mx-auto px-4">
      <div class="max-w-6xl mx-auto">
        <h2 class="text-3xl font-bold text-base-content mb-6">Study Materials & Resources</h2>

        <!-- Introduction -->
        <div class="bg-base-200 rounded-lg shadow-md p-6 mb-8">
          <h3 class="text-xl font-bold text-base-content mb-3">Your Journey of Discovery</h3>
          <p class="text-base-content leading-relaxed">
            We've curated a collection of books, videos, articles, and study programs to support your exploration of the Bahá'í teachings.
            Use the search and filters below to find materials that speak to your interests and questions.
          </p>
        </div>

        <!-- SearchableResources Component -->
        <SearchableResources
          resources={resources}
          categories={categories}
          allTags={allTags}
          client:load
        />
      </div>
    </div>
  </section>
</BaseLayout>
