---
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import Calendar from '../components/Calendar.astro';
import { getPublishedItems, expandRecurringEventsSync } from '../lib/directus';
import { getNextOccurrences, formatEventDate } from '../lib/recurrence';
import type { Event, Prayer } from '../lib/directus';

// Get all published events and prayers from Directus
const events = await getPublishedItems<Event>('events');
const prayers = await getPublishedItems<Prayer>('prayers');

// Expand recurring events to show next 5 occurrences each
const eventOccurrences = expandRecurringEventsSync(events, getNextOccurrences, formatEventDate, 5);
---

<BaseLayout title="Home - Haringey Baháʼí Community" description="Welcome to the Haringey Baháʼí Community website. Learn about the Faith, join our events, and explore spiritual resources.">
  <Hero
    title="Welcome to the Haringey Baháʼí Community"
    subtitle="A community in North London dedicated to unity, service, and spiritual growth"
    imageUrl="/images/bahai/buildings/shrine-bab/shrine-bab-001.jpg"
    overlayOpacity={60}
  />

  <section class="py-12">
    <div class="container mx-auto px-4">
      <div class="grid md:grid-cols-3 gap-8 mb-16">
        <div class="bg-base-200 rounded-lg shadow-md p-6 text-center">
          <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-8 h-8 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
            </svg>
          </div>
          <h3 class="text-xl font-bold mb-2">Learn & Study</h3>
          <p class="text-base-content opacity-70 mb-4">Explore the sacred writings and join study circles to deepen your understanding.</p>
          <a href="/study" class="text-accent-cyan hover:text-accent-cyan-dark font-medium">Explore Resources →</a>
        </div>

        <div class="bg-base-200 rounded-lg shadow-md p-6 text-center">
          <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-8 h-8 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
          </div>
          <h3 class="text-xl font-bold mb-2">Connect & Serve</h3>
          <p class="text-base-content opacity-70 mb-4">Join our community activities and contribute to building a better world.</p>
          <a href="/community" class="text-accent-cyan hover:text-accent-cyan-dark font-medium">Community Life →</a>
        </div>

        <div class="bg-base-200 rounded-lg shadow-md p-6 text-center">
          <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-8 h-8 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
            </svg>
          </div>
          <h3 class="text-xl font-bold mb-2">Pray & Reflect</h3>
          <p class="text-base-content opacity-70 mb-4">Access prayers, devotional programs, and spiritual guidance.</p>
          <a href="/devotional" class="text-accent-cyan hover:text-accent-cyan-dark font-medium">Devotional Resources →</a>
        </div>
      </div>

      <div class="grid lg:grid-cols-3 gap-8">
        <div class="lg:col-span-2">
          <h2 class="text-3xl font-bold text-base-content mb-6">About the Baháʼí Faith</h2>
          <div class="bg-base-200 rounded-lg shadow-md p-6 mb-8">
            <p class="text-base-content opacity-90 mb-4 leading-relaxed">
              The Baháʼí Faith is a religion founded in the 19th century that teaches the essential worth of all religions
              and the unity of all people. Baháʼís believe that God has sent a series of divine Messengers throughout
              history to guide humanity's spiritual and social development.
            </p>
            <p class="text-base-content opacity-90 mb-4 leading-relaxed">
              Central to Baháʼí belief is the conviction that humanity is one single race and that the day has come for
              its unification in one global society. The principal challenge facing the peoples of the earth is to accept
              the fact of their oneness and to assist the processes of unification.
            </p>
            <a href="/about" class="inline-block bg-primary hover:bg-accent-cyan-dark text-white px-6 py-3 rounded-lg font-medium transition">
              Learn More About the Faith
            </a>
          </div>

          <h2 class="text-3xl font-bold text-base-content mb-6">Featured Prayer</h2>
          <div class="bg-gradient-to-br from-primary/5 to-primary/10 rounded-lg shadow-md p-8 border border-primary/20">
            <p class="text-base-content opacity-90 italic leading-relaxed mb-4 text-lg">
              {prayers[0].text.split('\n\n')[0]}
            </p>
            <p class="text-sm text-base-content opacity-70">— {prayers[0].author}</p>
            <a href="/devotional/prayers" class="inline-block mt-4 text-accent-cyan hover:text-accent-cyan-dark font-medium">
              View More Prayers →
            </a>
          </div>
        </div>

        <div>
          <Calendar occurrences={eventOccurrences} />
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
